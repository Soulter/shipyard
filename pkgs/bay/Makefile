.PHONY: install run test clean init-db docker-build docker-run

# Install dependencies
install:
	@echo "ğŸ“¦ Installing dependencies with uv..."
	uv pip install -e .

# Create .env file from template if it doesn't exist
setup:
	@if [ ! -f .env ]; then \
		echo "âš™ï¸  Creating .env file from template..."; \
		cp .env.example .env; \
		echo "âš ï¸  Please edit .env file to configure your settings"; \
	fi

# Initialize database
init-db:
	@echo "ğŸ”§ Initializing database..."
	python scripts/init_db.py

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	python scripts/test_bay.py

# Test Docker integration
test-docker:
	@echo "ğŸ³ Testing Docker integration..."
	python scripts/test_docker.py

# Run the application
run: setup init-db
	@echo "ğŸš€ Starting Bay API server..."
	python run.py

# Clean up generated files
clean:
	@echo "ğŸ§¹ Cleaning up..."
	rm -f bay.db bay.db-journal
	rm -rf __pycache__ app/__pycache__ app/*/__pycache__
	rm -rf *.egg-info
	rm -rf .pytest_cache

# Format code
format:
	@echo "ğŸ¨ Formatting code..."
	black app/ scripts/
	isort app/ scripts/

# Type check
type-check:
	@echo "ğŸ” Type checking..."
	mypy app/

# Docker build
docker-build:
	@echo "ğŸ³ Building Docker image..."
	docker build -t bay-api .

# Docker run
docker-run: docker-build
	@echo "ğŸ³ Running Bay API in Docker..."
	docker-compose up -d

# Stop Docker services
docker-stop:
	@echo "ğŸ³ Stopping Docker services..."
	docker-compose down

# Show logs
logs:
	@echo "ğŸ“‹ Showing logs..."
	docker-compose logs -f bay

# Development setup
dev: install setup init-db
	@echo "ğŸ”§ Development environment ready!"
	@echo "ğŸ’¡ Run 'make run' to start the server"
	@echo "ğŸ’¡ Run 'make test' to run tests"
